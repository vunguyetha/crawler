<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<div th:replace="~{common/nav :: nav-bar}"></div>
<div class="container">
    <h1 class="mt-5 mb-3">Product Table</h1>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Short URL</th>
            <!--            <th>Original Price</th>-->
            <th>Price</th>
            <th>Rating Average</th>
            <!--            <th>Short Description</th>-->
            <th>Quantity Sold</th>
            <!--            <th>Thumbnail URL</th>-->
            <th>Inventory Type</th>
            <!--            <th>Category</th>-->
            <th>Brand</th>
            <th>Seller</th>
        </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center" id="pagination">
        </ul>
    </nav>
</div>

<script th:inline="javascript">
    const products = [[${products}]];
    const itemsPerPage = 10;
    let currentPage = 1;

    function showPage(page) {
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageData = products.slice(startIndex, endIndex);
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        pageData.forEach(product => {
            tableBody.innerHTML += `
                <tr>
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.shortUrl}</td>
                    <!--<td>${product.originalPrice}</td>-->
                    <td>${product.price}</td>
                    <td>${product.ratingAverage}</td>
                   <!--<td>${product.shortDescription}</td>-->
                    <td>${product.quantitySold}</td>
                    <!--<td>${product.thumbnailUrl}</td>-->
                    <td>${product.inventoryType}</td>
                    <!--<td>${product.category}</td>-->
                    <td>${product.brand}</td>
                    <td>${product.seller}</td>
                </tr>
            `;
        });
    }

    function changePage(page) {
        currentPage = page;
        showPage(currentPage);
        renderPagination();
    }

    function renderPagination() {
        const totalPages = Math.ceil(products.length / itemsPerPage);
        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';

        const prevButton = document.createElement('li');
        prevButton.classList.add('page-item');
        prevButton.innerHTML = `
            <a class="page-link" onclick="changePage(${currentPage - 1})" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        `;
        if (currentPage === 1) {
            prevButton.classList.add('disabled');
        }
        pagination.appendChild(prevButton);

        const maxVisiblePages = 5;
        let startPage = currentPage - Math.floor(maxVisiblePages / 2);
        let endPage = currentPage + Math.floor(maxVisiblePages / 2);

        if (startPage < 1) {
            startPage = 1;
            endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        }

        if (endPage > totalPages) {
            endPage = totalPages;
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        if (startPage > 1) {
            pagination.appendChild(createPageItem(1));
            if (startPage > 2) {
                pagination.appendChild(createEllipsis());
            }
        }

        for (let i = startPage; i <= endPage; i++) {
            pagination.appendChild(createPageItem(i));
        }

        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                pagination.appendChild(createEllipsis());
            }
            pagination.appendChild(createPageItem(totalPages));
        }

        const nextButton = document.createElement('li');
        nextButton.classList.add('page-item');
        nextButton.innerHTML = `
            <a class="page-link" onclick="changePage(${currentPage + 1})" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        `;
        if (currentPage === totalPages) {
            nextButton.classList.add('disabled');
        }
        pagination.appendChild(nextButton);
    }

    function createPageItem(page) {
        const li = document.createElement('li');
        li.classList.add('page-item');
        li.innerHTML = `
            <a class="page-link" onclick="changePage(${page})">${page}</a>
        `;
        if (page === currentPage) {
            li.classList.add('active');
        }
        return li;
    }

    function createEllipsis() {
        const li = document.createElement('li');
        li.classList.add('page-item');
        li.innerHTML = `
            <a class="page-link" disabled>...</a>
        `;
        return li;
    }

    showPage(currentPage);
    renderPagination();
</script>

</body>
</html>
